tinymce.PluginManager.add('tweet', function(editor, url) {
    // Adds a menu item to the tools menu    
   function tweetbox() {
      editor.windowManager.open({
        title: sestweet_text,
				class: 'twitterbox',
				width :600,
				height:100,
        body: [
          {type: 'textbox', name: 'message', label: 'Tweet (*first 140 characters will be shared)',class:'tweetthis'}
        ],
        onsubmit: function(e) {
          if(!e.data.message)
            return "";
          // Insert content when the window form is submitted
          editor.insertContent('<div data-name="sestweet_tweet" style="width:'+sestweet_widgthinper+';overflow:hidden;margin:10px auto;border:'+sestweet_borderwidth+' solid '+sestweet_bordercolor+';font-size:'+sestweet_fontsize+';line-height: normal;border-radius: 6px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;"><a href="https://twitter.com/intent/tweet?text=' + encodeURI(e.data.message) + '%20@'+sestweet_twitter_handler+'%0a&url=sestweet_page_url" target="_blank" rel="nofollow" style="padding: 15px;display:block;text-decoration:none !important;">' + e.data.message + ' @'+sestweet_twitter_handler+'<span style="float:right;font-size: 12px;padding:6px 21px 2px 0;text-decoration: none;background-image: url(./application/modules/Sestweet/externals/images/tweet.png);background-repeat: no-repeat;background-position: right bottom;">'+sestweet_text+'</span></a></div>');
        }
      });
   }
   editor.addButton('tweet', {
		tooltip: sestweet_text,
		icon : 'tweet',
		text: '',
		onclick: tweetbox
	});
    editor.addMenuItem('tweet', {
      text: '',
      context: 'insert',
      onclick: tweetbox
    });
  });